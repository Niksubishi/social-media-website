import{h as m,a as I}from"./headers-RPXbKLV3.js";import{s as b,i as B,l as $}from"./backToTop-CYJU5UeQ.js";import{b as L}from"./read-DRj3_9BT.js";import{i as P,a as k,o as C}from"./comment-NGB9Di3-.js";import{c as p}from"./constants-Dyo2zk30.js";async function v(t){const e=`${p}/${t}?_followers=true&_following=true`,n={method:"GET",headers:m()};try{const o=await fetch(e,n);if(!o.ok)throw new Error("Failed to fetch profile.");return(await o.json()).data}catch(o){throw console.error("Error fetching profile:",o),o}}async function S(t){const e=`${p}/${t}?_followers=true`,n={method:"GET",headers:m()},o=await fetch(e,n);if(!o.ok)throw new Error("Failed to fetch followers.");return(await o.json()).data.followers||[]}async function U(t){const e=`${p}/${t}?_following=true`,n={method:"GET",headers:m()},o=await fetch(e,n);if(!o.ok)throw new Error("Failed to fetch following.");return(await o.json()).data.following||[]}async function x(t,{avatar:e,banner:n,bio:o}){const r=`${p}/${encodeURIComponent(t)}`,s={};e&&(s.avatar=e),n&&(s.banner=n),o&&(s.bio=o);try{const a=await fetch(r,{method:"PUT",headers:m(),body:JSON.stringify(s)});if(!a.ok)throw new Error(`Failed to update profile: ${a.statusText}`);const{data:u}=await a.json();return u}catch(a){throw console.error("Error updating profile:",a),a}}async function F(t){const e=document.getElementById("update-profile-form"),n=document.getElementById("avatar-url"),o=document.getElementById("banner-url"),r=document.getElementById("bio"),s=document.getElementById("save-profile"),a=document.getElementById("cancel-update"),u=document.getElementById("update-profile-button");try{const i=await v(t);n.value=i.avatar?.url||"",o.value=i.banner?.url||"",r.value=i.bio||"",u.addEventListener("click",()=>{e.style.display=e.style.display==="none"?"block":"none"}),s.addEventListener("click",async()=>{try{const l={avatar:{url:n.value},banner:{url:o.value},bio:r.value},c=await x(t,l);document.getElementById("profile-avatar").src=c.avatar?.url||"/images/default-avatar.png",document.getElementById("banner-image").style.backgroundImage=`url('${c.banner?.url||"/images/default-banner.jpg"}')`,document.getElementById("profile-bio").textContent=c.bio||"No bio available.",e.style.display="none"}catch(l){console.error("Error updating profile:",l),alert("Failed to update profile. Please try again.")}}),a.addEventListener("click",()=>{e.style.display="none",n.value=i.avatar?.url||"",o.value=i.banner?.url||"",r.value=i.bio||""})}catch(i){console.error("Error initializing update profile form:",i)}}async function M(t,e){const n=`${p}/${t}/${e?"unfollow":"follow"}`,o={method:"PUT",headers:m()};try{const r=await fetch(n,o);if(!r.ok){const a=await r.json();throw console.error("Error response from API:",a),new Error(a.errors?.[0]?.message||`Failed to ${e?"unfollow":"follow"} the user.`)}const s=await r.json();return alert(`Successfully ${e?"unfollowed":"followed"} ${t}!`),s}catch(r){console.error("Error during follow/unfollow:",r),alert(`Could not ${e?"unfollow":"follow"} ${t}. Please try again.`)}}function j(t,e){const n=document.getElementById("follow-button");n&&(n.textContent=e?"Unfollow":"Follow",n.addEventListener("click",async()=>{try{await M(t,e),e=!e,n.textContent=e?"Unfollow":"Follow"}catch(o){console.error("Error toggling follow state:",o)}}))}function T(t,e){const n=document.getElementById("followers-count"),o=document.getElementById("following-count"),r=document.getElementById("followers-modal"),s=document.getElementById("modal-title"),a=document.getElementById("modal-list"),u=document.querySelector(".close-modal");if(!n||!o||!r||!s||!a||!u){console.error("One or more required DOM elements for the modal are missing.");return}n.textContent=`${e._count?.followers||0} followers`,o.textContent=`${e._count?.following||0} following`;async function i(l){let c=[];a.innerHTML="";try{l==="followers"?c=await S(t):l==="following"&&(c=await U(t))}catch(f){console.error(`Error fetching ${l}:`,f),alert(`Failed to load ${l}. Please try again.`);return}if(!c||c.length===0){alert(`No ${l} to display.`);return}c.forEach(f=>{const w=document.createElement("li");w.classList.add("modal-list-item"),w.innerHTML=`
                <img src="${f.avatar?.url||"/images/default-avatar.png"}" alt="${f.name}" class="user-avatar">
                <span>${f.name}</span>
            `,a.appendChild(w)}),s.textContent=`${l.charAt(0).toUpperCase()+l.slice(1)} List`,r.style.display="block"}n.addEventListener("click",()=>i("followers")),o.addEventListener("click",()=>i("following")),u.addEventListener("click",()=>{r.style.display="none"}),window.addEventListener("click",l=>{l.target===r&&(r.style.display="none")})}I();b();B();const g=document.querySelector("#profile-posts-container"),_=document.getElementById("banner-image"),z=document.getElementById("profile-avatar"),D=document.getElementById("profile-username"),N=document.getElementById("profile-bio"),y=document.getElementById("welcome-message"),E=document.querySelector(".nav-container"),h=document.querySelector(".notLoggedInNavbar"),q=new URLSearchParams(window.location.search),d=q.get("username")||localStorage.getItem("username");d?async function(){try{const t=await v(d);if(_.style.backgroundImage=`url('${t.banner?.url||"/images/default-banner.jpg"}')`,z.src=t.avatar?.url||"/images/default-avatar.png",D.textContent=t.name||"Unknown User",N.textContent=t.bio||"No bio available.",d===localStorage.getItem("username"))y.textContent="Welcome back!",E.style.display="block",h.style.display="none",F(d);else{y.textContent=`${t.name||"User"}'s Profile`,E.style.display="none",h.style.display="flex";const e=t.followers?.some(n=>n.name===localStorage.getItem("username"));j(d,e)}T(d,t),await $(g,async(e,n,o)=>L(d,e,n,o)),P(),k()}catch(t){console.error("Error loading profile data:",t),g.innerHTML="<p>Error loading profile. Please try again later.</p>"}}():g.innerHTML="<p>Error: User not found.</p>";g.addEventListener("click",C);
