import{b as c}from"./constants-rqNHC8Ty.js";import{i as m}from"./passwordUtils-BFr2e6nP.js";import{i as u}from"./navigation-BhUJQ3dQ.js";async function f({email:n,password:t}){try{console.log("Attempting login to:",c);const e=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:t})});if(console.log("Response status:",e.status),console.log("Response ok:",e.ok),!e.ok){let o="Login failed. Please check your credentials.";try{const s=await e.json();o=s.errors?.[0]?.message||s.message||o}catch(s){console.warn("Could not parse error response:",s)}throw new Error(o)}const i=await e.json();return console.log("Login successful"),i}catch(e){throw console.error("Error in login:",e),e.name==="TypeError"&&e.message.includes("Load failed")?new Error("Network error. Please check your internet connection and try again."):e.name==="TypeError"&&e.message.includes("Failed to fetch")?new Error("Unable to connect to server. Please try again later."):e}}async function p(n){n.preventDefault(),console.log("Login form submitted");const t=n.target,e=t.email.value.trim(),i=t.password.value.trim();if(!e||!i){const r="Please enter both email and password.",a=document.querySelector("#login-error");a&&(a.textContent=r,a.style.color="red");return}console.log("Attempting login for email:",e);const o=t.querySelector("button[type='submit'], button:not([type])"),s=o?.textContent;o&&(o.disabled=!0,o.textContent="Logging in...");try{const r=await f({email:e,password:i});if(console.log("Login API response received:",r),!r.data||!r.data.accessToken)throw new Error("Invalid response from server. Please try again.");localStorage.setItem("token",r.data.accessToken),localStorage.setItem("username",r.data.name),window.dispatchEvent(new CustomEvent("userLoggedIn")),console.log("Login successful, redirecting to home"),window.location.href="/"}catch(r){console.error("Login error:",r);const a=r.message||"An error occurred. Please try again later.",l=document.querySelector("#login-error");l&&(l.textContent=a,l.style.color="red",l.style.display="block")}finally{o&&(o.disabled=!1,o.textContent=s||"Login")}}u();m();const g=document.forms.login,d=document.createElement("div");d.id="login-error";g.appendChild(d);g.addEventListener("submit",async n=>{n.preventDefault();const t=document.querySelector("button");t.disabled=!0;try{await p(n)}catch(e){console.error("Error in login:",e.message)}finally{t.disabled=!1}});
